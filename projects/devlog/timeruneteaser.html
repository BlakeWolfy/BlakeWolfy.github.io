<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>I Miss you sister...</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: black;
  font-family: "Press Start 2P", monospace;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  align-items: center;
}

/* Imagem acima da caixa de diálogo */
#panel {
  max-width: 90%;
  width: 600px;
  margin-bottom: 20px;
  display: block;
}

/* Caixa de diálogo retangular */
#dialog {
  width: 90%;
  max-width: 900px;
  min-height: 180px;
  border: 4px solid white;
  padding: 20px;
  box-sizing: border-box;
  font-size: 22px;
  line-height: 1.4;
  background: black;
  border-radius: 0;
  white-space: pre-wrap;
  word-break: break-word;
  overflow-wrap: break-word;
  overflow: hidden;
  position: relative;
}

/* Texto A */
.text-a {
  color: #7fd7ff; /* azul claro */
  font-family: "Press Start 2P", monospace;
  display: inline-block;
  max-width: 100%;
  word-break: break-word;
}

/* Texto B (gradiente) */
.text-b {
  font-family: "Press Start 2P", monospace;
  display: inline-block;
  max-width: 100%;
  word-break: break-word;
  background: linear-gradient(90deg, #ff9f43, #6dff8f);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

/* Indicador de próximo */
#next {
  position: absolute;
  bottom: 10px;
  right: 20px;
  color: white;
  font-size: 18px;
  opacity: 0;
  animation: blink 1s infinite;
}

@keyframes blink {
  0%, 50% { opacity: 0; }
  51%, 100% { opacity: 1; }
}

@media (max-width: 480px) {
  #dialog {
    font-size: 16px;
    min-height: 160px;
    padding: 15px;
  }
  #next {
    font-size: 14px;
    right: 15px;
  }
  #panel {
    width: 90%;
  }
}
</style>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>

<!-- Imagem acima da caixa -->
<img id="panel" src="../../assets/imagens/prophecy-panel.png" alt="Painel de Profecia">

<!-- Canvas para estrelas -->
<canvas id="stars" style="position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:1;"></canvas>

<script>
const canvas = document.getElementById('stars');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const stars = [];
const numStars = 80;

// Cria estrelas com posição aleatória
for(let i=0;i<numStars;i++){
  stars.push({
    x: Math.random()*canvas.width,
    y: Math.random()*canvas.height,
    r: Math.random()*2+1,
    speed: Math.random()*1+0.2
  });
}

// Função de animação
function animate(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  stars.forEach(s=>{
    ctx.beginPath();
    ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
    ctx.fillStyle = 'white';
    ctx.fill();
    s.y += s.speed;
    if(s.y > canvas.height) s.y = -s.r; // volta para o topo
  });
  requestAnimationFrame(animate);
}

animate();

// Ajusta canvas ao redimensionar a tela
window.addEventListener('resize', ()=>{
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});
</script>
  
<!-- Caixa de diálogo -->
<div id="dialog">
  <span id="text"></span>
  <div id="next">▶</div>
</div>

<!-- Música -->
<audio id="bgm" src="../../assets/musics/a_lost_person.m4a" loop></audio>

<script>
const dialogos = [
  { speaker: "A", text: "Ei! Oque você tá fazendo sentada aí?" },
  { speaker: "B", text: "Ah-! Irmã? É você! Achei que era a mamãe..." },
  { speaker: "A", text: "Meh. Ela tá trabalhando." },
  { speaker: "B", text: "De noite?" },
  { speaker: "A", text: "É. Ela ficou presa com papelada." },
  { speaker: "B", text: "Ah... de qualquer jeito, eu tava olhando pras estrelas cadentes!" },
  { speaker: "A", text: "Oooh! Você já fez um pedido?" },
  { speaker: "B", text: "hehe! Sim!" },
  { speaker: "A", text: "Qual foi? É segredo ou sua irmãzona aqui pode saber?" },
  { speaker: "B", text: "hehe... bem não ri ok?... eu fiz um pedido... para a gente sempre estar juntas e  felizes!" },
  { speaker: "A", text: "Hahah-" },
  { speaker: "B", text: "Ei- você falou que não ia rir!" },
  { speaker: "A", text: "Não é isso. É que essse também é o meu pedido." }
];

let index = 0;
let char = 0;
let typing = false;

const textEl = document.getElementById("text");
const nextEl = document.getElementById("next");
const bgm = document.getElementById("bgm");

// Função para escrever o texto letra por letra
function escrever() {
  typing = true;
  nextEl.style.opacity = 0;
  textEl.textContent = "";
  char = 0;

  const atual = dialogos[index];
  textEl.className = atual.speaker === "A" ? "text-a" : "text-b";

  const intervalo = setInterval(() => {
    textEl.textContent += atual.text.charAt(char);
    char++;
    if (char >= atual.text.length) {
      clearInterval(intervalo);
      typing = false;
      nextEl.style.opacity = 1;
    }
  }, 32);
}

// Função para avançar o diálogo
function avancar() {
  if (typing) return;

  // Inicia música na primeira interação
  if (bgm.paused) {
    bgm.volume = 0.5;
    bgm.play().catch(() => console.log("Clique para iniciar a música."));
  }

  index++;
  if (index < dialogos.length) {
    escrever();
  } else {
    window.location.href = "https://blakewolfy.github.io/projects/devlog/timerune.html";
  }
}

// Avança diálogo com clique ou Enter/Espaço
document.addEventListener("click", avancar);
document.addEventListener("keydown", e => { if(e.key === "Enter" || e.key === " ") avancar(); });

// Inicia o primeiro diálogo
escrever();
</script>

</body>
</html>
